#!/bin/bash

chmod +x /challenge/submit
export PATH="/run/dojo/bin:$PATH"

set -euo pipefail
rm -rf /home/hacker/dojo-amend
mkdir -p /home/hacker/dojo-amend
cd /home/hacker/dojo-amend

git init -b main >/dev/null

git config user.name "hacker"
git config user.email "hacker@sjtu.edu.cn"

echo "# Please change this line" > README.md

git add README.md
GIT_AUTHOR_NAME="hacker" GIT_AUTHOR_EMAIL="hacker@sjtu.edu.cn" \
GIT_COMMITTER_NAME="hacker" GIT_COMMITTER_EMAIL="hacker@sjtu.edu.cn" \
  git commit -m "this commit message is not correct" >/dev/null

git rev-parse HEAD > /challenge/.amend_initial_sha

chown -R hacker:hacker /home/hacker/dojo-amend

git config --global --add safe.directory /home/hacker/dojo-amend

source /mnt/site-packages/setup_packages.sh
/mnt/sudo/setup.sh