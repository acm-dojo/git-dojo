#!/bin/bash

set -eou pipefail

chmod +x /challenge/submit

# Setup the git proxy:
# https://github.com/acm-dojo/git-sample-repo.git -> /opt/git-sample-repo/

mv /challenge/git-sample-repo /opt/git-sample-repo
mv /opt/git-sample-repo/.raw.git /opt/git-sample-repo/.git  # unfreeze the repo
chown hacker:hacker -R /opt/git-sample-repo/

sudo -u hacker git config --global url."/opt/git-sample-repo/".insteadOf "https://github.com/acm-dojo/git-sample-repo"
sudo -u hacker git config --global url."/opt/git-sample-repo/".insteadOf "git@github.com:acm-dojo/git-sample-repo"

/mnt/site-packages/setup_packages.sh
/mnt/sudo/setup.sh