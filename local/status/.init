#!/bin/bash

chmod +x /challenge/submit
export PATH="/run/dojo/bin:$PATH"

set -euo pipefail
rm -rf /home/hacker/dojo-status
mkdir -p /home/hacker/dojo-status/include
mkdir -p /home/hacker/dojo-status/src
mkdir -p /home/hacker/dojo-status/src/book
mkdir -p /home/hacker/dojo-status/src/user

touch /home/hacker/dojo-status/CMakeLists.txt
touch /home/hacker/dojo-status/src/main.cpp
touch /home/hacker/dojo-status/src/user/user.cpp
touch /home/hacker/dojo-status/include/user.hpp

cd /home/hacker/dojo-status
git init -b main >/dev/null

git config user.name "hacker"
git config user.email "hacker@sjtu.edu.cn"

echo "# Status Practice" > README.md

# 首次提交所有文件
git add .
git commit -m "init repo" >/dev/null

chown -R hacker:hacker /home/hacker/dojo-status

git config --global --add safe.directory /home/hacker/dojo-status

source /mnt/site-packages/setup_packages.sh
/mnt/sudo/setup.sh