#!/bin/bash

chmod +x /challenge/submit
export PATH="/run/dojo/bin:$PATH"

set -euo pipefail
rm -rf /home/hacker/dojo-branch
mkdir -p /home/hacker/dojo-branch
cd /home/hacker/dojo-branch

git init -b main >/dev/null

git config user.name "hacker"
git config user.email "hacker@sjtu.edu.cn"

echo "# Branch Practice Repo" > README.md
cat <<'TXT' > progress.md
Day 1: Learned git init.
Day 2: Practiced git status.
TXT

git add README.md progress.md
GIT_AUTHOR_NAME="hacker" GIT_AUTHOR_EMAIL="hacker@sjtu.edu.cn" \
GIT_COMMITTER_NAME="hacker" GIT_COMMITTER_EMAIL="hacker@sjtu.edu.cn" \
  git commit -m "Log first two days" >/dev/null

git rev-parse HEAD > /challenge/.branch_main_initial_sha

chown -R hacker:hacker /home/hacker/dojo-branch

git config --global --add safe.directory /home/hacker/dojo-branch

source /mnt/site-packages/setup_packages.sh
/mnt/sudo/setup.sh