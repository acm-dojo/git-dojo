#!/bin/bash

/mnt/sudo/setup.sh
/mnt/site-packages/setup_packages.sh

chmod +x /challenge/submit
export PATH="/run/dojo/bin:$PATH"

set -euo pipefail
rm -rf /home/hacker/dojo-branch
mkdir -p /home/hacker/dojo-branch
cd /home/hacker/dojo-branch

git init -b main >/dev/null

git config user.name "Git Dojo"
git config user.email "dojo@example.com"

echo "# Branch Practice Repo" > README.md
cat <<'TXT' > progress.md
Day 1: Learned git init.
Day 2: Practiced git status.
TXT

git add README.md progress.md
GIT_AUTHOR_NAME="Git Dojo" GIT_AUTHOR_EMAIL="dojo@example.com" \
GIT_COMMITTER_NAME="Git Dojo" GIT_COMMITTER_EMAIL="dojo@example.com" \
  git commit -m "Log first two days" >/dev/null

cat <<'TXT' >> progress.md
Day 3: Draft branch workflow notes. (stash me!)
TXT

git rev-parse HEAD > /challenge/.branch_main_initial_sha

chown -R hacker:hacker /home/hacker/dojo-branch
